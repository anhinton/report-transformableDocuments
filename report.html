<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>A transformable markup document format</title>
<meta name="author" content="Ashley Noel Hinton, Paul Murrell">
<meta name="description" content="Technical report proposing a markup format for producing transformable documents.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="stylesheet.css">
</head>
<body><div class="main">
<div class="title">
<h1 class="title">A transformable markup document format</h1>
<p class="author">Ashley Noel Hinton<br><a href="ahin017@aucklanduni.ac.nz">ahin017@aucklanduni.ac.nz</a></p>
<p class="author">Paul Murrell<br><a href="paul@stat.auckland.ac.nz">paul@stat.auckland.ac.nz</a></p>
<p class="author">Department of Statistics, The University of Auckland</p>
<p class="date"></p>
</div>
    <section id="introduction">
      <p>Many technologies now exist for writing a document in format
      that can be transformed into various output formats for
      sharing. This report proposes that using markup, rather than one
      of the Markdown languages, is a good fit for writing flexible
      human- and machine-readable transformable documents. We propose
      a transformable markup <code>document</code> format written in
      XML. We provide several examples of how the
      <code>document</code> format could be transformed.</p>
    </section>

    <!-- end section -->

    <section>    
      <h1>Why a markup format</h1>

      <p>When writing reports and articles for publication in
      journals, books, online or otherwise, an author will employ one
      of many document formats to describe the typographical and
      structural details of her document. Common formats for research
      publication include the <a href="https://latex-project.org/">LaTeX</a> system for producing
      printed documents, and <a href="https://www.w3.org/html/">HTML</a> for producing online
      documents. These and other formats allow an author to have
      low-level control over a certain type of output, but usually do
      not offer control over multiple outputs.</p>

      <p>The <a href="http://pandoc.org/index.html">Pandoc</a>
      document converter is frequently used to allow an author to
      write a document in one format and then convert to another. For
      example an author could create an HTML document and use Pandoc
      to generate a LaTeX version of this document. An author will
      gnerally write a document using the Pandoc Markdown format, and
      then use Pandoc to convert the document to one (or several)
      formats for publication.</p>

      <p>Pandoc Markdown is a variant of <a href="https://daringfireball.net/projects/markdown/">Markdown</a>,
      a lightweight markup language written as a simpler way to author
      HTML documents. Markdown is intended to be readable without
      conversion, and as such is written so as not to appear to
      contain markup tags or formatting. While this can makes it easy
      for an author to write a document with common formatting it
      makes it very difficult to have fine-grained control over the
      eventual output document(s).</p>

      <p>As well as needing control over the appearance and structure
      of a document, an author will often need to embed software code
      to be executed to produce the final version of the
      document. Various tools exist for executing code embedded in a
      literate document to produce the desired output. For example, an
      author can embed R code in her document and use the <a href="http://yihui.name/knitr/">Knitr</a> package to execute the
      R code and produce a final document. An author embeds R code in
      another document format, for example HTML or LaTeX, and
      processes the document to produce an output document in the same
      format.</p>

      <p>The <a href="http://rmarkdown.rstudio.com/">R Markdown</a>
      package combines the dynamic document processing of Knitr with the
      common authoring format of Pandoc Markdown. An author can write a
      document in Pandoc Markdown which contains embedded R code to be
      executed. The author can then execute the code and produce an
      output document for publication in one of the many formats
      available through Pandoc document conversion.</p>

      <p>It is clear that a document author has many options, and the
      implementation of R Markdown in the RStudio IDE is an indication
      that many developers in the R world at least see Markdown as a
      very useful authoring tool. The following use cases will server to
      highlight some of the drawbacks to authoring in Markdown. These
      drawbacks will inform the design of a transformable document
      solution described in this report.</p>

      <h2>Limitations of Markdown</h2>

      <p>While Markdown can be very useful for authoring simple
      documents quickly (Markdown's creators took inspiration from the
      formatting conventions of plain text emails) an author also
      makes several sacrifices in choosing Markdown over a markup
      language like HTML. Two examples of the limitations of Markdown
      are the creating of lists and tables. List creation in Pandoc
      Markdown is desrcibed below.
      <a href="http://pandoc.org/README.html#tables">Table creation</a>
      is left as an exercise for the reader.</p>

      <p>In Pandoc Markdown a simple list is created by
      prepending a “*”, “+”, or “-” character to the
      beginning of each list item, as in the following example:</p>

      <pre><code>  * one
  * two
  * three</code></pre>
    
      <p>If an author wishes to create an embedded list, she must use
      the four space rule to indent each embedded list.</p>

      <pre><code>  * outer list 1
      - inner list 1
      - inner list 2
  * outer list 2</code></pre>

      <p>At even two levels this process is already quite complex. As
      list membership depends on whitespace it can be a frustrating
      exercise trying to make changes to a complex list, let alone
      author a list in the first place.</p>

      <p>In contrast, a author using HTML markup can indicate an
      unordered list using a<code>&lt;ul&gt;</code> element, which
      <code>&lt;li&gt;</code> elements for each item, as in the
      following code:</p>

      <pre><code>&lt;ul&gt;
  &lt;li&gt;one&lt;/li&gt;
  &lt;li&gt;two&lt;/li&gt;
  &lt;li&gt;three&lt;/li&gt;
&lt;/ul&gt;</code></pre>

      <p>Similarly, an embedded list simply nests the same structure
      inside a list structure, as in the following code:</p>

      <pre><code>&lt;ul&gt;
  &lt;li&gt;outer list 1
    &lt;ul class="subList"&gt;
      &lt;li&gt;inner list 1&lt;/li&gt;
      &lt;li&gt;inner list 2&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;outer list 2&lt;/li&gt;
&lt;/ul&gt;</code></pre>

      <p>The author does not have to count white space, and it is
      trivial to make changes to this list structure.</p>

      <p>Markup like HTML also gives a document author more control
      over the output than Markdown. The author of the HTML list
      example above has used the <code>class</code> attribute to
      indicate the inner list belongs to the “subList”
      class. Using <code>class</code> an author can apply output
      styles or perform other actions on subsets of elements. When a
      document authored in Markdown is transformed to HTML its lists
      will be marked up using the same HTML list tags as above, but an
      author of a Markdown document does not have access to these
      <code>class</code> attributes for customising output. She could
      include raw HTML in her Pandoc Markdown document, but this
      limits the output types to those using HTML.</p>
  
      <p>A document author has various methods for embedding chunks of
      code in her document. For example, an author of a Knitr HTML or
      LaTeX document can enclose code chunks to be executed in
      specially formatted comments in the respective document
      languages. For example, a document author can embed and R code
      in a Knitr HTML document as in the following code:</p>

      <pre><code>&lt;!-- begin.rcode
x &lt;- rnorm(n = 10)
plot(x)
end.rcode--&gt;</code></pre>

      <p>Similarly an author can embed R code in a Knitr LaTeX
      document as in the following code:</p>

      <pre><code>%% begin.rcode
% x &lt;- rnorm(n = 10)
% plot(x)
%% end.rcode</code></pre>

      <p>A document author using the R Markdown package can enclose R
      code chunks in special “fenced code” blocks as in the
      following code:</p>

      <pre><code>```{r}
x &lt;- rnorm(n = 10)
plot(x)
```</code></pre>

      <p>While the use of these methods for including code makes it
      quick and easy to write a document it makes it more difficult
      for an author to do extra processing to chunks of code before
      producing the a final document. In contrast, an author creating
      an HTML document might wrap R code in <code>&lt;code&gt;</code>
      elements as in the following code:</p>

      <pre><code>&lt;code class="R"&gt;
  x &lt;- rnorm(n = 10)
  plot(x)
&lt;/code&gt;</code></pre>

      <p>If an author marked up code chunks in this fashion she could,
      for example, make use of tools which employ the XPATH query
      language to locate <code>&lt;code&gt;</code> elemenents and
      perform transformations. If the author gives R code chunks the
      class “R”, as in the above example, she could perform
      transformations on just the R code chunks.</p>

      <p>If an author uses Pandoc Markdown to write a document she can
      include raw HTML or raw TeX language elements to control the
      document output. These raw code sections are only processed by
      Pandoc when creating the associated output formats, and would
      otherwise be ignored. There is no simple method for creating
      custom sections or formats within Pandoc Markdown.</p>

      <p>While an author using HTML is also unable to expect new and
      custom elements to be recognised by a web browser, the fact that
      HTML is a form of XML means an author can invent her own XML
      elements for document writing. These custom elements could then
      be processed using an XML transformation tool like XSL
      Transformations to convert the custom elements to valid HTML
      code. A markup document format has the benefit of providing a
      simplified authoring format without sacrificing fine control
      when required.</p>

      <p>Markdown has proven itself to be very useful for document
      authors, and it is not the suggestion of this report that a
      markup format replace Markdown entirely. Rather this report
      proposes that in situation where Markdown is not powerful enough
      for a document author a markup format like the one described in
      the next section might provide the solution. Importantly, a well
      designed markup document should allow an author to recover a
      Markdown document as <em>output</em>, thus providing a readable
      plain text document. While a format like Markdown is designed to
      satisfy a set of <em>known</em> transformations a format based
      on markup can also satisfy future <em>unknown</em>
      transformations, e.g. extracting subsets of elements.</p>
    </section>

    <!-- end section -->

    <section>
      <h1>A <code>document</code> markup format</h1>

      <p>In the previous section we described some of the limitations
      in the Markdown document authoring format. It is our proposal
      that an authoring format based in XML provides more control and
      flexibility when authoring a document. When an author uses a
      Markdown format she is limited to the formatting tags and
      transformations found in Markdown; similarly an author using
      HTML markup is limited to HTML tags. Authoring a document in
      XML, however, permits an author not only to include all of the
      tags and transformations afforded by HTML, but also any
      customised tags or transformations she may require. A
      <code>document</code> author is free to invent new personalised
      tags to suit her current document transformation needs. In this
      section we describe such a custom<code>document</code> markup
      format.</p>

      <p>The transformable document format described in this report is
      an XML file with <code>document</code> as the root element. This
      document has two child elements: <code>metadata</code> and
      <code>body</code>.</p>

      <p>The <code>metadata</code> element contains the document metadata,
      with elements for the document <code>title</code> and
      <code>subtitle</code>, <code>author</code> information,
      <code>date</code> of publication, and a <code>description</code>
      section. An example <code>metadata</code> element follows:</p>

      <pre><code>&lt;metadata&gt;
  &lt;title&gt;Today should be a holiday&lt;/title&gt;
  &lt;author&gt;
    &lt;name&gt;Ashley Noel Hinton&lt;/name&gt;
    &lt;email&gt;ahin017@aucklanduni.ac.nz&lt;/email&gt;
  &lt;/author&gt;
  &lt;date&gt;25 December 2015&lt;/date&gt;
&lt;/metadata&gt;
</code></pre>

      <p>The <code>body</code> element contains the document's main
      content. The following elements are used in the same way as they
      are used in HTML
      (<a href="https://www.w3.org/TR/html-markup/elements.html">https://www.w3.org/TR/html-markup/elements.html</a>):</p>

      <ul>
	<li>
<code>a</code> – hyperlink</li>
	<li>
<code>code</code> – code fragment</li>
	<li>
<code>em</code> – emphatic stress</li>
	<li>
<code>figcaption</code> – figure caption</li>
	<li>
<code>figure</code> – figure with optional caption</li>
	<li>
<code>h1</code> – heading</li>
	<li>
<code>h2</code> – heading</li>
	<li>
<code>h3</code> – heading</li>
	<li>
<code>img</code> – image</li>
	<li>
<code>li</code> – list item</li>
	<li>
<code>ol</code> – ordered list</li>
	<li>
<code>p</code> – paragraph</li>
	<li>
<code>pre</code> – preformatted text</li>
	<li>
<code>q</code> – quoted text</li>
	<li>
<code>section</code> – section</li>
	<li>
<code>strong</code> – strong importance</li>
	<li>
<code>ul</code> – unordered list</li>
      </ul>

      <p>The <code>&lt;url&gt;</code> element is introduced in the
      <code>document</code> format to indicate a hyperlink where the
      enclosed URL is both the href and the value. The following code
      block demonstrates the use of the <code>url</code> element:</p>

      <pre><code>&lt;ul&gt;
  &lt;li&gt;modular&lt;/li&gt;
  &lt;li&gt;reusable&lt;/li&gt;
  &lt;li&gt;shareable&lt;/li&gt;
  &lt;li&gt;&lt;url&gt;https://github.com/anhinton/conduit&lt;/url&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

      <p>The resulting output:</p>

      <ul>
  <li>modular</li>
  <li>reusable</li>
  <li>shareable</li>
  <li><a href="https://github.com/anhinton/conduit">https://github.com/anhinton/conduit</a></li>
</ul>

      <p>The <code>document</code> XML format uses
      <code>&lt;code&gt;</code> elements to indicate blocks of
      computer code, just as in HTML. Dynamic code chunks which are to
      be executed are marked using the <code>class</code> attribute to
      <code>code</code>. For example chunks of R code which are to be
      executed used the Knitr package are wrapped in a
      <code>&lt;code&gt;</code> element with
      <code>class="knitr"</code>. An author can also provide a
      <code>name</code> attribute for the knitr code chunk, as well as
      knitr <code>options</code>. A document author can also use
      <code>CDATA</code> sections to wrap code with reserved XML
      characters. The following code demonstrates how to include an R
      code chunk to be executed with Knitr:</p>

      <pre><code>&lt;code class="knitr" name="knitrDemo" options="tidy=FALSE"&gt;&lt;![CDATA[x &lt;- rnorm(n = 10)
mean(x)]]&gt;&lt;/code&gt;
</code></pre>

      <p>And the following is the result of executing this code
      chunk:</p>

<div class="chunk" id="knitrDemo"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rnorm</span><span class="hl std">(</span><span class="hl kwc">n</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl kwd">mean</span><span class="hl std">(x)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] -0.3191205
</pre></div>
</div></div>

      <p>The <code>document</code> format also makes use of the
      <code>include</code> element from XInclude
      (<a href="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</a>) namespace to
      include XML content from external files. This allows
      <code>document</code> authors to embed other documents which may
      be authored separately from the main document. There is no
      simple method of doing this directly in either HTML or Pandoc
      Markdown.</p>

      <p>The next sections describes some simple transformations which
      can be performed on the <code>document</code> markup format
      using freely available open source tools. This report was itself
      written in the <code>document</code> markup format—the
      source code is available at <a href="report.xml">report.xml</a>. </p>
    </section>

    <!-- end section -->

    <section>
      <h1>Transforming the <code>document</code> markup format</h1>

      <p>This section describes how freely available open source tools
      can be used to transform the <code>document</code> markup format
      in different ways. The examples include creating an HTML
      document, preparing R code chunks for executing using Knitr,
      processing XInclude elements, and some steps towards creating a
      PDF document. The command line tools <code>xsltproc</code> is
      used in the following examples, but many other tools are
      available to do the transformations described.</p>

      <h2 id="example1">1. Transforming to HTML</h2>

      <p>The <code>document</code> markup format can be easily
      transformed into HTML using XSL Transformations
      (<a href="https://www.w3.org/TR/1999/REC-xslt-19991116">https://www.w3.org/TR/1999/REC-xslt-19991116</a>). XSLT
      stylsheets are XML documents which describe how another XML
      document can be transformed. They can be used to produce new XML
      documents, such as HTML, or other plain text formats. The
      command line XSLT processor <code>xsltproc</code>
      (<a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>) can be used to apply an
      XSLT stylesheet to an XML document to produce an HTML output
      document.</p>

      <p>As a large part of the <code>document</code> format is based
      on HTML already we do not have to desrcibe very many
      transformations in our XSLT stylesheet. We will need to
      transform the <code>metadata</code> section of the
      <code>document</code> to HTML <code>head</code> elements and an
      appropriate title section. We also need to transform our custom
      <code>&lt;url&gt;</code> elements to HTML hyperlinks.</p>

      <p>The full XSLT stylesheet used in this example can be found at
      <a href="examples/documentToHtml.xsl">examples/documentToHtml.xsl</a>. The XSLT code used to
      transform <code>url</code> elements to HTML hyperlinks is as
      follows:</p>

      <pre><code>&lt;xsl:template match="url"&gt;
  &lt;xsl:element name="a"&gt;      
    &lt;xsl:attribute name="href"&gt;
      &lt;xsl:value-of select="node()"/&gt;
    &lt;/xsl:attribute&gt;
    &lt;xsl:value-of select="node()"/&gt;
  &lt;/xsl:element&gt;
&lt;/xsl:template&gt;</code></pre>

      <p>The source <code>document</code>
      <a href="examples/toHtml.xml">examples/toHtml.xml</a> contains the following XML:</p>

      <pre><code>&lt;?xml version="1.0" encoding="UTF-8"  ?&gt;
&lt;document&gt;
  &lt;metadata&gt;
    &lt;title&gt;Today should be a holiday&lt;/title&gt;
    &lt;author&gt;
      &lt;name&gt;Ashley Noel Hinton&lt;/name&gt;
      &lt;email&gt;ahin017@aucklanduni.ac.nz&lt;/email&gt;
    &lt;/author&gt;
    &lt;date&gt;25 December 2015&lt;/date&gt;
  &lt;/metadata&gt;

  &lt;body&gt;
    &lt;p&gt;For many years I have believed that 25 December should be a
    public holiday, and I am now prepared to provide evidence for
    this.&lt;/p&gt;

    &lt;ol&gt;
      &lt;li&gt;There aren't any other holidays in December.&lt;/li&gt;
      &lt;li&gt;Schools are usually closed anyway.&lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;More information can be found at
    &lt;url&gt;https://en.wikipedia.org/wiki/December_25&lt;/url&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/document&gt;
</code></pre>

      <p>This document can be transformed to HTML using the following
      call to <code>xsltproc</code>:</p>

      <pre><code>xsltproc -o examples/toHtml.html examples/documentToHtml.xsl examples/toHtml.xml</code></pre>

      <p>The resulting HTML document can be viewed at
      <a href="examples/toHtml.html">examples/toHtml.html</a>.</p>

      <h2 id="example2">2. Process <code>xi:include</code> elements</h2>

      <p>The <code>document</code> markup format uses XInclude
      elements (<a href="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</a>) to embed
      text from external documents. These documents referenced in
      these elements can be processed and embedded directly into the
      output document using the command line tool
      <code>xsltproc</code> (<a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>).</p>

      <p>We will use the same XSLT stylesheet we used in the previous
      example. The source <code>document</code>
      <a href="examples/processXinclude.xml">examples/processXinclude.xml</a> contains the following
      XML:</p>

      <pre><code>&lt;?xml version="1.0" encoding="UTF-8"  ?&gt;
&lt;document xmlns:xi="http://www.w3.org/2001/XInclude"&gt;
  &lt;metadata&gt;
    &lt;title&gt;Today should be a holiday&lt;/title&gt;
    &lt;author&gt;
      &lt;name&gt;Ashley Noel Hinton&lt;/name&gt;
      &lt;email&gt;ahin017@aucklanduni.ac.nz&lt;/email&gt;
    &lt;/author&gt;
    &lt;date&gt;25 December 2015&lt;/date&gt;
  &lt;/metadata&gt;

  &lt;body&gt;
    &lt;p&gt;For many years I have believed that 25 December should be a
    public holiday, and I am now prepared to provide evidence for
    this.&lt;/p&gt;

    &lt;xi:include href="evidenceList.xml" parse="xml"/&gt;

    &lt;p&gt;More information can be found at
    &lt;url&gt;https://en.wikipedia.org/wiki/December_25&lt;/url&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/document&gt;
</code></pre>

      <p>The element <code>&lt;xi:include
      href="evidenceList.xml" parse="xml"/&gt;</code> indicates that
      the XML included in <a href="examples/evidenceList.xml">examples/evidenceList.xml</a> is to
      be included in the output document.</p>

      <p>We will add the <code>--xinclude</code> tag to our call to
      <code>xsltproc</code> to process the XInclude elements when we
      do our transformation:</p>

      <pre><code class="long">xsltproc --xinclude -o examples/processXinclude.html examples/documentToHtml.xsl  examples/processXinclude.xml</code></pre>

      <p>The resulting HTML document can be viewed at
      <a href="examples/processXinclude.html">examples/processXinclude.html</a>.</p>

      <h2 id="example3">3. Subsetting elements: prepare R code chunks for Knitr</h2>

      <p>The Knitr package lets document authors embed chunks of R
      code in special comment code and execute these chunks to produce
      an output document. The use of comments to indicate code makes
      it difficult to perform custom actions on R code marked up in
      this way. The <code>document</code> markup format wraps chunks
      of R code to be executed by Knitr in <code>&lt;code
      class="knitr"&gt;</code> elements. This allows an author using
      the <code>document</code> markup format to perform any
      operations she likes on chunks of R code. An XSLT stylesheet can
      be used to transform chunks of code marked up in this fashion
      into Knitr R code chunks in a Knitr HTML document.</p>

      <p>The full XSLT stylesheet used in this example can be found at
      <a href="examples/documentToRhtml.xsl">examples/documentToRhtml.xsl</a>. The XSLT code used to
      transform <code>&lt;code class="knitr"&gt;</code> elements to
      Knitr R code chunks is as follows:</p>

      <pre><code class="long">&lt;xsl:template match="code[@class='knitr']"&gt;
  &lt;xsl:comment&gt;&lt;xsl:text&gt;begin.rcode &lt;/xsl:text&gt;&lt;xsl:value-of select="@name"/&gt;&lt;xsl:if test="@options"&gt;&lt;xsl:text&gt;, &lt;/xsl:text&gt;&lt;xsl:value-of select="@options"/&gt;&lt;/xsl:if&gt;
  &lt;xsl:text&gt;&amp;#xA;&lt;/xsl:text&gt;
  &lt;xsl:value-of select="node()"/&gt;
  &lt;xsl:text&gt;&amp;#xA;end.rcode&lt;/xsl:text&gt;&lt;/xsl:comment&gt;
&lt;/xsl:template&gt;</code></pre>

      <p>The source <code>document</code>
      <a href="examples/knitrChunk.xml">examples/knitrChunk.xml</a> contains the following
      XML:</p>

      <pre><code>&lt;?xml version="1.0" encoding="UTF-8"  ?&gt;
&lt;document&gt;
  &lt;metadata&gt;
    &lt;title&gt;Plotting in R&lt;/title&gt;
    &lt;author&gt;
      &lt;name&gt;Ashley Noel Hinton&lt;/name&gt;
      &lt;email&gt;ahin017@aucklanduni.ac.nz&lt;/email&gt;
    &lt;/author&gt;
    &lt;date&gt;25 December 2015&lt;/date&gt;
  &lt;/metadata&gt;

  &lt;body&gt;
    &lt;p&gt;A plot to celebrate 25 December:&lt;/p&gt;

    &lt;code class="knitr"&gt;&lt;![CDATA[x &lt;- rnorm(n = 10)
plot(x)]]&gt;&lt;/code&gt;

    &lt;p&gt;More information can be found at
    &lt;url&gt;https://en.wikipedia.org/wiki/December_25&lt;/url&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/document&gt;
</code></pre>

      <p>This document can be transformed to Knitr HTML using the
      following call to <code>xsltproc</code>:</p>

      <pre><code>xsltproc -o examples/knitrChunk.Rhtml examples/documentToRhtml.xsl examples/knitrChunk.xml</code></pre>

      <p>The resulting Knitr HTML document can be viewed at
      <a href="examples/knitrChunk.Rhtml">examples/knitrChunk.Rhtml</a>.</p>

      <h2 id="example4">4. Extended transformations</h2>

      <p>The previous three examples have shown single transformations
      on documents written in the <code>document</code> markup
      format. Authors of <code>document</code> files are not limited
      to just one transformation, however. In the <a href="#example3">previous example</a> we demonstrated how a
      module author can convert a document with marked up chunks of R
      code into a document which can then be processed using the Knitr
      package in R. The <a href="examples/knitrChunk.Rhtml">Knitr HTML
      document</a> produced in the previous example can be converted
      to HTML using the following code in R:</p>

<div class="chunk" id="rhtmlToHtml"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(knitr)</span>
<span class="hl std">oldwd</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">setwd</span><span class="hl std">(</span><span class="hl str">&quot;examples&quot;</span><span class="hl std">)</span>
<span class="hl kwd">knit</span><span class="hl std">(</span><span class="hl kwc">input</span> <span class="hl std">=</span> <span class="hl str">&quot;knitrChunk.Rhtml&quot;</span><span class="hl std">)</span>
<span class="hl kwd">setwd</span><span class="hl std">(oldwd)</span>
</pre></div>
</div></div>

      <p>The resulting HTML document can be viewed at
      <a href="examples/knitrChunk.html">examples/knitrChunk.html</a>.</p>

      <p>This output document is the result of two transformation
      steps, using two different tools (<code>xsltrproc</code>, and
      the Knitr package in R), each producing an output document. The
      <code>document</code> format can be used in this way to author
      documents that require several transformation steps, and several
      transformation tools. The result of each transformation can be
      provided as a source document for the following
      transformation. In the following discussion we explore how a
      <code>document</code> author might manage multiple
      transformations on a <code>document</code>.</p>
      
    </section>

    <section>
      <h1>Discussion</h1>

      <p>The <code>document</code> markup format provides a reasonably
      simple authoring format in which an author can write documents
      for one or several output formats. Like Markup, the
      <code>document</code> format allows an author to target HTML and
      PDF as output formats, among others. Unlike Markdown the
      <code>document</code> format is not limited to a known set of
      transformations. Adding a custom transformation to the
      <code>document</code> format is as easy as using a custom XML
      element while authoring—the transformation of this custom
      element could then be defined in an XSLT stylesheet, for
      example.</p>

      <p>The kinds of transformations available to an author using the
      <code>document</code> format are as many and diverse as those
      available when using XML. This report has described two basic
      transformations:</p>

      <ul>
	<li>
<a href="#example1">Transformation to HTML</a> using an
	XSLT stylesheet and the <code>xsltproc</code> command line
	tool.</li>
	<li>
<a href="#example2">Incorporating external XML</a> files
	using XInclude's <code>&lt;xi:include&gt;</code> elements,
	processed with the <code>xmllint</code> command line
	tool.</li>
      </ul>

      <p>This report has also demonstrated how transformations can be
      <a href="#example3">applied to subsets of elements</a>, as in
      the example where chunks of R code wrapped in <code>&lt;code
      class="knitr"&gt;</code> elements were transformed into Knitr R
      code chunks using an XSLT stylesheet and
      <code>xsltproc</code>. The ability to perform transformations on
      subsets of elements using the <code>document</code> markup
      format allows an author much finer control over the output
      produced than when using Markdown. For instance, an author may
      wish to produce a teacher's and student's copy of a document,
      with some sections only visible to the teacher. Subsetting
      elements would allow an author to do produce a student's and as
      teacher's output from the same source
      <code>document</code>—this would likely require separate
      source documents if done using Markdown.</p>

      <p>While only HTML and Knitr HTML output was demonstrated in
      this report, transformation to other formats is of course
      possible. One popular format for sharing articles and reports is
      the PDF format. One method for producing a PDF from the
      <code>document</code> format is to use the <code>Pandoc</code>
      document converter on the HTML output produced in the <a href="#example1">first example</a>. The transformation can be
      performed using the following call to <code>Pandoc</code>:</p>

      <pre><code>pandoc -s -o examples/toHtml.pdf examples/toHtml.html</code></pre>

      <p>The resulting PDF document can be viewed at <a href="examples/toHtml.pdf">examples/toHtml.pdf</a>. If a
      <code>document</code> author wanted to have greater control over
      the PDF produced she might instead use an XSLT stylesheet and
      <code>xsltproc</code> to transform the <code>document</code> to
      the LaTeX format. This could then be transformed to PDF using a
      tool like <code>pdflatex</code>.</p>

      <p>The production of PDF and other formats, and the <a href="#example4">secondary transformation example</a> in this
      report, where a Knitr HTML file produced from a
      <code>document</code> is transformed into HTML, demonstrate how
      a <code>document</code> author may want to perform multiple
      transformation, employing multiple tools. For example an author
      may wish to do all of the following to a
      <code>document</code>:</p>

      <ol>
	<li>Merge XML from external documents indicated by
	<code>&lt;xi:include&gt;</code> elements.</li>
	<li>Convert the document to Knitr HTML.</li>
	<li>Process the code chunks in the Knitr HTML to produce and
	HTML output.</li>
      </ol>

      <p>A potential method for handling a pipeline of such
      transformations is the OpenAPI architecture (<a href="http://stattech.wordpress.fos.auckland.ac.nz/2015-01-introducing-openapi/">Introducing
      OpenAPI</a>, <a href="http://stattech.wordpress.fos.auckland.ac.nz/2016-08-openapi-version-0-6/">OpenAPI
      version 0.6</a>). A document author could describe each of the
      transformation steps as an OpenAPI <code>module</code>, and use
      these modules to describe the entire transformation in an
      OpenAPI <code>pipeline</code>.</p>

      <p>Using an OpenAPI <code>pipeline</code> to describe a
      <code>document</code> transformation doesn't just provide a
      quick method of performing all transformations at
      once—wrapping transformation code in OpenAPI
      <code>module</code>s also provides a means by which the author
      of a transformation <code>pipeline</code>, or anyone else, can
      modify and extend the transformation. For example, if a user of
      a transformation <code>pipeline</code> following the steps
      listed above wished to perform another transformation between
      step 1 and step 2, she would only need to create a
      <code>module</code> which took the output produced in step 1 as
      input, and produced the input required by step 2 as
      output—this new <code>module</code> could then be placed
      into a copy of the <code>pipeline</code>. The production of a
      teacher's and student's version of the HTML output could be
      produced by branching the <code>pipeline</code> to process a
      subset of elements in the appropriate way. Similarly, a
      different output format—PDF, for example—could be
      produced by adding the appropriate transformation
      <code>module</code>s to the <code>pipeline</code> while
      <em>still producing the original HTML output</em>.</p>
    </section>
	
    <section>
      <h1>Technical requirements</h1>

      <ul>
	<li>Conduit version 0.6-3, a prototype OpenAPI
	glue system R package, was used to produce the final version of this
	report
	(<a href="https://github.com/anhinton/conduit/releases/tag/v0.6-3">https://github.com/anhinton/conduit/releases/tag/v0.6-3</a>).</li>
	<li>Knitr version 1.12.3, an R package, was used for the
	transformations in this report
	(<a href="http://yihui.name/knitr/">http://yihui.name/knitr/</a>).</li>
	<li>Pandoc version 1.16.02 was used for the transformations in
	this report (<a href="http://pandoc.org">http://pandoc.org</a>).</li>
	<li>R version 3.3.1 was used for the transformations in this
	report (<a href="https://www.r-project.org/">https://www.r-project.org/</a>).</li>
	<li>All of the transformations described in this report were
	produced on a machine running Ubuntu 16.04 LTS 64-bit
	(<a href="http://www.ubuntu.com/">http://www.ubuntu.com/</a>).</li>
	<li>
<code>xmllint</code> using <code>libxml</code> version
	20903 was used in the transformations which produced this
	report (<a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>).</li>
	<li>
<code>xsltproc</code> using <code>libxml</code> 20903,
	<code>libxslt</code> 10128 and <code>libexslt</code> 817 was
	used for the transformations in this report
	(<a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>).</li>
      </ul>
      
    </section>

    <section>
      <h1>Summary</h1>

      <p>
      </p>
      
    </section>

    <section>
      <h1>Resources</h1>

      <ul>
	<li>The <a href="#example1">transformation to HTML</a> example
	uses the source document <a href="examples/toHtml.xml">examples/toHtml.xml</a>, and
	the XSLT stylesheet
	<a href="examples/documentToHtml.xsl">examples/documentToHtml.xsl</a>.</li>
	<li>The <a href="#example2">processing XInclude elements</a>
	example using the source document
	<a href="examples/processXinclude.xml">examples/processXinclude.xml</a>, and the XML file
	<a href="examples/evidenceList.xml">examples/evidenceList.xml</a>.</li>
	<li>The <a href="#example3">subsetting elements</a> example
	uses the source document <a href="examples/knitrChunk.xml">examples/knitrChunk.xml</a>,
	and the XSLT stylesheet
	<a href="examples/documentToRhtml.xsl">examples/documentToRhtml.xsl</a>.</li>
	<li>The <a href="#example4">extended transformation</a>
	example uses the output document
	<a href="examples/knitrChunk.Rhtml">examples/knitrChunk.Rhtml</a> produced by the <a href="#example3">third example</a> as its source
	document.</li>
	<li>This report was produced using an OpenAPI pipeline
	executed with <a href="https://github.com/anhinton/conduit/releases/tag/v0.6-3">Conduit
	version 0.6-3</a>. The source <code>document</code> is
	available at <a href="report.xml">report.xml</a>. The transformation
	pipeline can be found at
	<a href="transform/toHtml/pipeline.xml">transform/toHtml/pipeline.xml</a>—the pipeline's
	modules are at <a href="transform/toHtml/convertToRhtml.xml">transform/toHtml/convertToRhtml.xml</a>,
	<a href="transform/toHtml/xinclude.xml">transform/toHtml/xinclude.xml</a>,
	<a href="transform/toHtml/knitToHtml.xml">transform/toHtml/knitToHtml.xml</a>, and
	<a href="transform/toHtml/substituteEntities.xml">transform/toHtml/substituteEntities.xml</a>. The
	pipeline result object can be found at
	<a href="toHtml.tar.gz">toHtml.tar.gz</a>. The R script used to execute this
	pipeline is available at <a href="transform.R">transform.R</a>.</li>
      </ul>

    </section>

    <hr>

    <section>
      <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">A transformable markup document format</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Ashley Noel Hinton and Paul Murrell</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
    </section>
  </div></body>
</html>
